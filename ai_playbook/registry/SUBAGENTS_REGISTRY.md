# 🔴 SUBAGENTS REGISTRY — 必ず最初に読むこと

> **このファイルは SSOT（Single Source of Truth）です。**
> サブエージェントを呼び出す前に、必ずこのレジストリで選定ルールを確認してください。

---

## 📋 目次
1. [エージェント連携フロー](#エージェント連携フロー)
2. [選定フローチャート](#選定フローチャート)
3. [状況別エージェント早見表](#状況別エージェント早見表)
4. [エージェント一覧](#エージェント一覧)
5. [出力統一方針](#出力統一方針)
6. [迷ったときのデフォルト](#迷ったときのデフォルト)

---

## エージェント連携フロー

```
┌───────────────────────────────────────────────────────────────────────┐
│                         標準ワークフロー                               │
└───────────────────────────────────────────────────────────────────────┘

  ユーザー要求
       │
       ▼
┌─────────────┐   計画承認    ┌──────────────┐   レビュー依頼   ┌─────────────┐
│  PLANNER    │ ──────────▶  │ IMPLEMENTER  │ ──────────────▶  │  REVIEWER   │
│ (計画立案)  │              │   (実装)     │                  │ (レビュー)  │
└─────────────┘              └──────────────┘                  └─────────────┘
       │                           │                                  │
       │                           │                                  │
       │    ┌──────────────────────┘                                  │
       │    │ ブロッカー発生                                          │
       │    ▼                                                         │
       │  計画見直し依頼                                              │
       │                                                              │
       └──────────────────────◀──────────────────────────────────────┘
                         修正依頼 / 設計問題報告
```

### ハンドオフルール
| From | To | トリガー |
|------|-----|----------|
| planner | implementer | 計画承認後 |
| implementer | reviewer | 実装完了後 |
| reviewer | implementer | 修正必要時 |
| implementer | planner | ブロッカー発生時 |
| reviewer | planner | 設計問題発見時 |

---

## 選定フローチャート

```
┌─────────────────────────────────────────────────────────────┐
│ Q1: 今何をしたいですか？                                    │
└─────────────────────────────────────────────────────────────┘
          │
          ├─→ タスクを分解・計画したい ────→ 🎯 planner
          │
          ├─→ コードを実装したい ──────────→ 🔨 implementer
          │
          ├─→ コードをレビューしたい ──────→ 👀 reviewer
          │
          └─→ 上記以外 ────────────────────→ 「迷ったときのデフォルト」へ
```

```
┌─────────────────────────────────────────────────────────────┐
│ Q2: 現在のフェーズは？                                      │
└─────────────────────────────────────────────────────────────┘
          │
          ├─→ 要件・計画フェーズ ──────────→ 🎯 planner
          │
          ├─→ 実装フェーズ ────────────────→ 🔨 implementer
          │
          ├─→ レビューフェーズ ────────────→ 👀 reviewer
          │
          └─→ わからない ──────────────────→ 🎯 planner（まず計画）
```

---

## 状況別エージェント早見表

| 状況・トリガー | 使うエージェント | パス |
|----------------|------------------|------|
| 新しいタスクを受け取った | `planner` | [subagents/planner.md](../subagents/minimal/planner.md) |
| 要件が曖昧で進めない | `planner` | [subagents/planner.md](../subagents/minimal/planner.md) |
| タスクを分解したい | `planner` | [subagents/planner.md](../subagents/minimal/planner.md) |
| 計画が承認された | `implementer` | [subagents/implementer.md](../subagents/minimal/implementer.md) |
| コードを書きたい | `implementer` | [subagents/implementer.md](../subagents/minimal/implementer.md) |
| バグを修正したい | `implementer` | [subagents/implementer.md](../subagents/minimal/implementer.md) |
| 実装が完了した | `reviewer` | [subagents/reviewer.md](../subagents/minimal/reviewer.md) |
| PRを確認したい | `reviewer` | [subagents/reviewer.md](../subagents/minimal/reviewer.md) |
| マージ前の品質確認 | `reviewer` | [subagents/reviewer.md](../subagents/minimal/reviewer.md) |

---

## エージェント一覧

### 1. planner（計画立案）
| 項目 | 内容 |
|------|------|
| **パス** | [subagents/planner.md](../subagents/minimal/planner.md) |
| **責務** | タスク分解、前提確認、DoD設計 |
| **使うスキル** | `phase-planning`, `worklog-update` |
| **呼ぶとき** | 新タスク受領、要件曖昧、計画見直し |
| **呼ばないとき** | 計画が既にある、緊急ホットフィックス |
| **出力** | 計画書（タスク一覧、DoD、リスク） |

#### 品質基準
- ✅ 1タスク = 8時間以内
- ✅ 全タスクにDoDがある
- ✅ 曖昧な用語がない
- 🚫 承認なしで進めない

---

### 2. implementer（実装）
| 項目 | 内容 |
|------|------|
| **パス** | [subagents/implementer.md](../subagents/minimal/implementer.md) |
| **責務** | 最小差分で実装、テスト作成、確認手順提示 |
| **使うスキル** | `bug-investigation`, `worklog-update` |
| **呼ぶとき** | 計画承認後、コード変更、バグ修正 |
| **呼ばないとき** | 計画がない、設計が決まっていない |
| **出力** | 変更コード、テスト、確認手順 |

#### 品質基準
- ✅ 全変更にテストがある
- ✅ 確認手順が提示されている
- ✅ DoDを達成している
- 🚫 方針提示なしで実装しない
- 🚫 テストなしで完了しない

---

### 3. reviewer（レビュー）
| 項目 | 内容 |
|------|------|
| **パス** | [subagents/reviewer.md](../subagents/minimal/reviewer.md) |
| **責務** | 品質評価、セキュリティ確認、修正案提示 |
| **使うスキル** | `code-review`, `worklog-update` |
| **呼ぶとき** | 実装完了後、PR確認、マージ前 |
| **呼ばないとき** | 実装中、計画フェーズ |
| **出力** | レビューコメント、修正案、判定 |

#### 品質基準
- ✅ セキュリティチェック必須
- ✅ 問題には修正案を提示
- ✅ 良い点も記載
- 🚫 曖昧な指摘をしない
- 🚫 LGTMだけで承認しない

---

## 出力統一方針

すべてのサブエージェントは以下の構造で出力すること：

```markdown
# [エージェント名] 出力: [タスク名]

## 1. 結論（Conclusion）
<最も重要な結論・判定を最初に>

## 2. 根拠（Evidence）
<結論に至った理由、観察、データ>

## 3. 詳細（Details）
<具体的な内容（計画/コード/コメント等）>

## 4. DoD達成状況
- [x] <達成した条件>
- [ ] <未達の条件>

## 5. 次のアクション
- [ ] <次のステップ>
- [ ] <ハンドオフ先>
```

### 出力ルール
| ルール | 説明 |
|--------|------|
| **結論ファースト** | 最初に結論・判定を述べる |
| **Markdown必須** | すべての出力はMarkdown形式 |
| **チェックリスト形式** | DoDは必ずチェックボックス形式 |
| **ハンドオフ明記** | 次のエージェントへの引き継ぎを明記 |
| **禁止事項厳守** | 各エージェントの禁止事項を守る |

---

## 迷ったときのデフォルト

### エージェントが決まらない場合

```
┌─────────────────────────────────────────────────────────────┐
│ デフォルト: planner                                         │
│                                                             │
│ 理由: 迷うということは計画が不明確。                        │
│       まずplannerで計画を立て、タスクを明確にする。         │
└─────────────────────────────────────────────────────────────┘
```

### 判断フローチャート

```
迷っている
    │
    ├─→ 何をすべきかわからない ───────→ 🎯 planner
    │
    ├─→ どう実装すべきかわからない ──→ 🎯 planner（設計を明確に）
    │
    ├─→ 実装はできたが不安 ──────────→ 👀 reviewer
    │
    └─→ 実装方法は明確 ──────────────→ 🔨 implementer
```

### 複数エージェントが該当する場合

**優先順位**（上から順に）:
1. `planner` — 計画がないなら計画を立てる
2. `implementer` — 計画があり実装が必要なら実装
3. `reviewer` — 実装があるならレビュー

### エージェントを使うか迷う場合

| 判断基準 | 使う | 使わない |
|----------|------|----------|
| タスク複雑度 | 複数ステップ | 単一操作 |
| リスク | 失敗の影響大 | 影響軽微 |
| 品質要件 | 高い | 低い |
| 再利用性 | テンプレ化したい | 一回限り |

---

## スキルとの連携

| エージェント | 使用スキル | 連携タイミング |
|--------------|------------|----------------|
| planner | `phase-planning` | 計画立案時 |
| planner | `worklog-update` | 計画完了記録時 |
| implementer | `bug-investigation` | バグ調査時 |
| implementer | `worklog-update` | 実装完了記録時 |
| reviewer | `code-review` | レビュー実施時 |
| reviewer | `worklog-update` | レビュー完了記録時 |

---

## 更新履歴

| 日付 | 変更内容 | 担当 |
|------|----------|------|
| 2026-01-17 | 初版作成、選定ルール追加 | System |
